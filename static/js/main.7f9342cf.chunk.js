(window["webpackJsonpvk-2019-app"]=window["webpackJsonpvk-2019-app"]||[]).push([[0],{162:function(e,t,a){e.exports=a(270)},269:function(e,t,a){},270:function(e,t,a){"use strict";a.r(t);a(163),a(189),a(191),a(192),a(194),a(195),a(196),a(197),a(198),a(199),a(200),a(201),a(203),a(204),a(205),a(206),a(207),a(208),a(209),a(210),a(211),a(212),a(214),a(215),a(216),a(217),a(218),a(219),a(220),a(221),a(222),a(223),a(224),a(225),a(226),a(227),a(228),a(229),a(230),a(231),a(235);var n=a(0),s=a.n(n),r=a(33),o=a.n(r),i=a(18),c=a.n(i),l=a(92),d=a(93),p=a(107),u=a(94),h=a(37),m=a(108),g=a(40),f=a.n(g),E=a(95),y=a(4),v=(a(263),a(264),a(104)),b=a.n(v),k=a(60),A=a.n(k),_=a(105),S=a.n(_),w=a(106),R=a.n(w),C=(a(269),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(p.a)(this,Object(u.a)(t).call(this,e))).callAPI=function(e,t){return t.access_token=a.state.vkAccessToken,t.v="5.101",E.a.send("VKWebAppCallAPIMethod",{method:e,params:t}).then((function(e){return e.data.response})).catch((function(e){return e}))},a.getGroups=function(){c.a.send("VKWebAppCallAPIMethod",{method:"groups.get",request_id:"1gr",params:{fields:"city,country,place,description,members_count,links,site,is_favorite,photo_100,photo_200",count:1e3,extended:!0,access_token:a.state.vkAccessToken,v:"5.101"}})},a.getToken=function(){c.a.send("VKWebAppGetAuthToken",{app_id:7150409,scope:"friends,groups"})},a.onRefresh=function(){a.setState({fetching:!0}),setTimeout((function(){a.getGroups()}),100)},a.state={activePanel:"discover",activeStory:"discover",activeView:"discover",appInitTimestamp:0,fetching:!1,fetchedUser:null,isAuthorized:!1,userAllowedScopes:!1,userData:[],userDiscoverFeed:[],userFriends:[],userFriendsInApp:[],userGeodata:null,userGroups:[],vkAccessToken:null},a.onPanelChange=a.onPanelChange.bind(Object(h.a)(a)),a.onStoryChange=a.onStoryChange.bind(Object(h.a)(a)),a.onViewChange=a.onViewChange.bind(Object(h.a)(a)),a.onRefresh=a.onRefresh.bind(Object(h.a)(a)),a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({appInitTimestamp:this.getTimestamp()}),c.a.subscribe((function(t){if(t.detail.hasOwnProperty("type"))switch(t.detail.type){case"VKWebAppGetUserInfoResult":console.log(t.detail.data),e.setState({fetchedUser:t.detail.data}),f.a.get("https://ybsapi.herokuapp.com/user/authorize/"+t.detail.data.id).then((function(t){console.log("! YBS-API: user/authorize"),t.data.hasOwnProperty("data")?(e.setState({isAuthorized:!0}),console.log(t.data.data)):console.log("! Auth: Failed!")})).catch((function(e){console.log("ERROR: "+e)}));break;case"VKWebAppGeodataResult":e.setState({userGeodata:{lat:t.detail.data.lat,lng:t.detail.data.long}});break;case"VKWebAppAccessTokenReceived":console.log("! Result: AccessToken"),t.detail.data.hasOwnProperty("access_token")?(e.setState({vkAccessToken:t.detail.data.access_token}),e.getFriends(),e.getGroups()):console.log("ACCESS_TOKEN_ERROR");break;case"VKWebAppCallAPIMethodResult":if(t.detail.data.hasOwnProperty("request_id"))switch(t.detail.data.request_id){case"1fr":f.a.post("https://ybsapi.herokuapp.com/user/friends/"+e.state.fetchedUser.id,t.detail.data.response.items).then((function(t){console.log("! YBS-API: user/friends"),t.data.hasOwnProperty("data")&&(console.log(t.data.data),e.setState({userFriendsInApp:t.data.data}))})).catch((function(e){console.log("ERROR: "+e)})),e.setState({userFriends:t.detail.data.response.items});break;case"1gr":f.a.post("https://ybsapi.herokuapp.com/user/communities/"+e.state.fetchedUser.id,t.detail.data.response.items).then((function(t){if(console.log("! YBS-API: user/communities"),t.data.hasOwnProperty("data")){console.log(t.data.data);var a,n=[],s=[];t.data.data.forEach((function(t){if(t.hasOwnProperty("name")&&t.name!==(e.state.fetchedUser.city.title||"")){var a=t.description.split(",");if(t.new_name=a[0],a.length>3){delete a[0];var r=a.filter((function(e){return e})).join(",").trim();t.new_desc=r.charAt(0).toUpperCase()+r.slice(1)}t.hasOwnProperty("photo_url")?n.push(t):s.push(t)}})),a=n.concat(s),e.setState({fetching:!1,userDiscoverFeed:a}),console.log(e.getAppRuntime())}})).catch((function(e){console.log("ERROR: "+e)})),e.setState({userGroups:t.detail.data.response.items})}break;default:console.warn(t.detail.type)}})),c.a.send("VKWebAppGetUserInfo",{}),this.getToken()}},{key:"getAppRuntime",value:function(){return this.getTimestamp()-this.state.appInitTimestamp}},{key:"getTimestamp",value:function(){return Math.floor(Date.now()/1e3)}},{key:"getFriends",value:function(){c.a.send("VKWebAppCallAPIMethod",{method:"friends.get",request_id:"1fr",params:{fields:"city,country,domain,first_name,last_name,photo_100,photo_200",count:1e3,order:"mobile",access_token:this.state.vkAccessToken,v:"5.101"}})}},{key:"onPanelChange",value:function(e){this.setState({activePanel:e.currentTarget.dataset.panel})}},{key:"onStoryChange",value:function(e){this.setState({activeStory:e.currentTarget.dataset.story})}},{key:"onViewChange",value:function(e){this.setState({activeView:e.currentTarget.dataset.view})}},{key:"render",value:function(){return s.a.createElement(y.c,{isWebView:!0},s.a.createElement(y.e,{activeStory:this.state.activeStory,tabbar:s.a.createElement(y.m,null,s.a.createElement(y.n,{onClick:this.onStoryChange,selected:"discover"===this.state.activeStory,"data-story":"discover",text:"\u0410\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0435"},s.a.createElement(b.a,null)),s.a.createElement(y.n,{onClick:this.onStoryChange,selected:"friends"===this.state.activeStory,"data-story":"friends",text:"\u0414\u0440\u0443\u0437\u044c\u044f"},s.a.createElement(S.a,null)),s.a.createElement(y.n,{onClick:this.onStoryChange,selected:"profile"===this.state.activeStory,"data-story":"profile",text:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"},s.a.createElement(A.a,null)))},s.a.createElement(y.o,{id:"discover",activePanel:"discover"},s.a.createElement(y.i,{id:"discover"},s.a.createElement(y.j,null,"\u041d\u0430\u041c\u0435\u0441\u0442\u0435"),s.a.createElement(y.k,{onRefresh:this.onRefresh},0===this.state.userDiscoverFeed.length&&this.getAppRuntime()<=10&&s.a.createElement(y.g,{style:{paddingTop:"20px"}},s.a.createElement(y.l,{size:"medium",style:{marginTop:20}}),s.a.createElement(y.d,{style:{textAlign:"center"}},"\u041c\u044b \u043f\u043e\u0434\u0431\u0438\u0440\u0430\u0435\u043c \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u044b\u0435 \u043c\u0435\u0441\u0442\u0430 \u0434\u043b\u044f \u0412\u0430\u0441, \u044d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0437\u0430\u043d\u044f\u0442\u044c \u043a\u0430\u043a\u043e\u0435-\u0442\u043e \u0432\u0440\u0435\u043c\u044f")),0===this.state.userDiscoverFeed.length&&this.getAppRuntime()>10&&s.a.createElement(y.g,{style:{paddingTop:"20px",paddingBottom:"20px"}},s.a.createElement(y.d,{style:{textAlign:"center"}},"\u0423\u043f\u0441, \u0447\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a (")),s.a.createElement(y.g,null,s.a.createElement(y.h,null,this.state.userDiscoverFeed.map((function(e,t){return s.a.createElement(y.g,{key:t,title:e.new_name},s.a.createElement(y.f,{slideWidth:"100%",align:"center",style:{height:200}},e.photo_url&&s.a.createElement("div",{style:{backgroundImage:'url("'+e.photo_url+'")',width:"100%"}}),!e.photo_url&&s.a.createElement("div",{style:{backgroundColor:"var(--accent)"}})),e.rating&&s.a.createElement(y.d,null,s.a.createElement("span",{style:{color:"#9a9a9a",marginRight:"5px"}},e.rating),s.a.createElement(R.a,{rating:e.rating,starEmptyColor:"white",starHoverColor:"gold",starRatedColor:"#ffcc00",name:"rating",starDimension:"16px",starSpacing:"2px"}),s.a.createElement("span",{style:{color:"#9a9a9a",marginRight:"5px"}},"(",e.user_ratings_total||0,")")),s.a.createElement(y.b,{description:e.address}))}))))))),s.a.createElement(y.o,{id:"friends",activePanel:"friends"},s.a.createElement(y.i,{id:"friends"},s.a.createElement(y.j,null,"\u041d\u0430\u041c\u0435\u0441\u0442\u0435"),s.a.createElement(y.g,null,s.a.createElement(y.h,null,this.state.userFriendsInApp.map((function(e,t){return s.a.createElement(y.d,{key:t},s.a.createElement(y.b,{before:s.a.createElement(y.a,{src:e.photo_200})},s.a.createElement("span",{style:{color:"#3a3a3a"}},e.first_name+" "+e.last_name),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#9a9a9a"}},"1 \u0443\u0440\u043e\u0432\u0435\u043d\u044c")))})))))),s.a.createElement(y.o,{id:"profile",activePanel:"profile"},s.a.createElement(y.i,{id:"profile"},s.a.createElement(y.j,null,"\u041d\u0430\u041c\u0435\u0441\u0442\u0435"),this.state.fetchedUser&&s.a.createElement(y.g,null,s.a.createElement(y.h,null,s.a.createElement(y.d,null,s.a.createElement(y.b,{before:this.state.fetchedUser.photo_200?s.a.createElement(y.a,{src:this.state.fetchedUser.photo_200}):s.a.createElement(y.a,null,s.a.createElement(A.a,null))},s.a.createElement("span",{style:{color:"#3a3a3a"}},"".concat(this.state.fetchedUser.first_name," ").concat(this.state.fetchedUser.last_name)),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#9a9a9a"}},"1 \u0443\u0440\u043e\u0432\u0435\u043d\u044c")))))))))}}]),t}(s.a.Component));c.a.send("VKWebAppInit"),o.a.render(s.a.createElement(C,null),document.getElementById("root"))}},[[162,1,2]]]);
//# sourceMappingURL=main.7f9342cf.chunk.js.map