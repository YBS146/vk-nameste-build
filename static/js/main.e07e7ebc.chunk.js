(window["webpackJsonpvk-2019-app"]=window["webpackJsonpvk-2019-app"]||[]).push([[0],{162:function(e,t,a){e.exports=a(269)},268:function(e,t,a){},269:function(e,t,a){"use strict";a.r(t);a(163),a(189),a(191),a(192),a(194),a(195),a(196),a(197),a(198),a(199),a(200),a(201),a(203),a(204),a(205),a(206),a(207),a(208),a(209),a(210),a(211),a(212),a(214),a(215),a(216),a(217),a(218),a(219),a(220),a(221),a(222),a(223),a(224),a(225),a(226),a(227),a(228),a(229),a(230),a(231),a(235);var n=a(0),s=a.n(n),i=a(33),r=a.n(i),o=a(18),c=a.n(o),l=a(92),d=a(93),u=a(107),h=a(94),p=a(37),g=a(108),m=a(45),f=a.n(m),b=a(95),v=a(4),E=(a(263),a(104)),y=a.n(E),k=a(60),A=a.n(k),R=a(105),F=a.n(R),S=a(106),P=a.n(S),_=(a(268),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).callAPI=function(e,t){return t.access_token=a.state.vkAccessToken,t.v="5.101",b.a.send("VKWebAppCallAPIMethod",{method:e,params:t}).then((function(e){return e.data.response})).catch((function(e){return e}))},a.getGroups=function(){c.a.send("VKWebAppCallAPIMethod",{method:"groups.get",request_id:"1gr",params:{fields:"description",count:180,extended:!0,access_token:a.state.vkAccessToken,v:"5.101"}})},a.getMe=function(){a.setState({isFetchingProfile:!0}),setTimeout((function(){a.setState({isFetchingProfile:!1})}))},a.getToken=function(){c.a.send("VKWebAppGetAuthToken",{app_id:7150409,scope:"friends,groups"})},a.onRefreshDiscover=function(){a.setState({isFetchingDiscover:!0}),setTimeout((function(){a.getGroups()}))},a.onRefreshFriends=function(){a.setState({isFetchingFriends:!0}),setTimeout((function(){a.getFriends()}))},a.onRefreshProfile=function(){a.setState({isFetchingProfile:!0}),setTimeout((function(){a.getMe()}))},a.state={activePanel:"discover",activeStory:"discover",activeView:"discover",appInitTimestamp:0,isFetchingDiscover:!1,isFetchingFriends:!1,isFetchingProfile:!1,fetchedUser:null,isAuthorized:!1,userData:[],userDiscoverFeed:[],userFriendsInApp:[],userGeodata:null,vkAccessToken:null},a.onPanelChange=a.onPanelChange.bind(Object(p.a)(a)),a.onStoryChange=a.onStoryChange.bind(Object(p.a)(a)),a.onViewChange=a.onViewChange.bind(Object(p.a)(a)),a.onRefreshDiscover=a.onRefreshDiscover.bind(Object(p.a)(a)),a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({appInitTimestamp:this.getTimestamp()}),c.a.subscribe((function(t){if(t.detail.hasOwnProperty("type"))switch(t.detail.type){case"VKWebAppGetUserInfoResult":e.debugLog(t.detail.data),e.setState({fetchedUser:t.detail.data}),f.a.get("https://ybsapi.herokuapp.com/user/authorize/"+t.detail.data.id).then((function(t){if(e.debugLog("! YBS-API: user/authorize"),t.data.hasOwnProperty("data")){e.debugLog(t.data.data);var a=t.data.data;a.hasOwnProperty("level")||(a.level=1),e.setState({isAuthorized:!0,userData:a})}else e.debugLog("! Auth: Failed!")})).catch((function(t){e.debugLog("ERROR: "+t)}));break;case"VKWebAppGeodataResult":e.debugLog("! Result: Geodata"),e.debugLog(t.detail.data.lat+","+t.detail.data.long),e.setState({userGeodata:{lat:t.detail.data.lat,lng:t.detail.data.long}});break;case"VKWebAppAccessTokenReceived":e.debugLog("! Result: AccessToken"),t.detail.data.hasOwnProperty("access_token")?(e.setState({vkAccessToken:t.detail.data.access_token}),e.getFriends(),e.getGroups()):e.debugLog("ACCESS_TOKEN_ERROR");break;case"VKWebAppCallAPIMethodResult":if(t.detail.data.hasOwnProperty("request_id"))switch(t.detail.data.request_id){case"1fr":f.a.post("https://ybsapi.herokuapp.com/user/friends/"+e.state.fetchedUser.id,t.detail.data.response.items).then((function(t){e.debugLog("! YBS-API: user/friends"),t.data.hasOwnProperty("data")?(e.debugLog(t.data.data),e.setState({isFetchingFriends:!1,userFriendsInApp:t.data.data})):e.debugLog(t.data)})).catch((function(t){e.debugLog("ERROR: "+t)}));break;case"1gr":f.a.post("https://ybsapi.herokuapp.com/user/communities/"+e.state.fetchedUser.id,t.detail.data.response.items).then((function(t){if(e.debugLog("! YBS-API: user/communities"),t.data.hasOwnProperty("data")){e.debugLog(t.data.data);var a=t.data.data;a.map((function(e,t){e.rating<3?delete a[t]:a[t].ratio=e.rating*e.user_ratings_total})),a=a.sort((function(e,t){return t.ratio-e.ratio})),e.setState({isFetchingDiscover:!1,userDiscoverFeed:a})}else e.debugLog(t.data)})).catch((function(t){e.debugLog("ERROR: "+t)}));break;default:e.debugLog(t.detail.data)}break;default:e.debugLog("ERROR: "+t.detail.type)}})),c.a.send("VKWebAppGetUserInfo",{}),this.getToken()}},{key:"debugLog",value:function(e){}},{key:"getAppRuntime",value:function(){return this.getTimestamp()-this.state.appInitTimestamp}},{key:"getTimestamp",value:function(){return Math.floor(Date.now()/1e3)}},{key:"getFriends",value:function(){c.a.send("VKWebAppCallAPIMethod",{method:"friends.get",request_id:"1fr",params:{fields:"first_name,last_name,photo_100,photo_200",count:1e3,order:"mobile",access_token:this.state.vkAccessToken,v:"5.101"}})}},{key:"onPanelChange",value:function(e){this.setState({activePanel:e.currentTarget.dataset.panel})}},{key:"onStoryChange",value:function(e){this.setState({activeStory:e.currentTarget.dataset.story})}},{key:"onViewChange",value:function(e){this.setState({activeView:e.currentTarget.dataset.view})}},{key:"render",value:function(){return s.a.createElement(v.c,{isWebView:!0},s.a.createElement(v.e,{activeStory:this.state.activeStory,tabbar:s.a.createElement(v.m,null,s.a.createElement(v.n,{onClick:this.onStoryChange,selected:"discover"===this.state.activeStory,"data-story":"discover",text:"\u0410\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0435"},s.a.createElement(y.a,null)),s.a.createElement(v.n,{onClick:this.onStoryChange,selected:"friends"===this.state.activeStory,"data-story":"friends",text:"\u0414\u0440\u0443\u0437\u044c\u044f"},s.a.createElement(F.a,null)),s.a.createElement(v.n,{onClick:this.onStoryChange,selected:"profile"===this.state.activeStory,"data-story":"profile",text:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"},s.a.createElement(A.a,null)))},s.a.createElement(v.o,{id:"discover",activePanel:"discover"},s.a.createElement(v.i,{id:"discover"},s.a.createElement(v.j,null,"\u041d\u0430 \u041c\u0435\u0441\u0442\u0435"),s.a.createElement(v.k,{onRefresh:this.onRefreshDiscover,isFetching:this.state.isFetchingDiscover},0===this.state.userDiscoverFeed.length&&this.getAppRuntime()<=10&&s.a.createElement(v.g,{style:{paddingTop:"20px",paddingBottom:"20px"}},s.a.createElement(v.l,{size:"medium",style:{marginTop:10}}),s.a.createElement(v.d,{style:{textAlign:"center"}},"\u0418\u0449\u0435\u043c \u0434\u043b\u044f \u0412\u0430\u0441 \u0447\u0442\u043e-\u0442\u043e \u043d\u043e\u0432\u0435\u043d\u044c\u043a\u043e\u0435!")),0===this.state.userDiscoverFeed.length&&this.getAppRuntime()>10&&s.a.createElement(v.g,{style:{paddingTop:"20px",paddingBottom:"20px"}},s.a.createElement(v.d,{style:{textAlign:"center"}},"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a...")),s.a.createElement(v.g,null,s.a.createElement(v.h,null,this.state.userDiscoverFeed.map((function(e,t){return s.a.createElement(v.g,{key:t,title:e.name,style:{marginBottom:"20px"}},s.a.createElement(v.f,{slideWidth:"100%",align:"center",style:{height:200}},e.photo_url&&s.a.createElement("div",{style:{width:"100%",backgroundImage:'url("'+e.photo_url+'")',backgroundRepeat:"none"}})),e.rating&&s.a.createElement(v.d,{style:{verticalAlign:"middle",lineHeight:"20px"}},s.a.createElement("span",{style:{color:"#9a9a9a",marginRight:"10px"}},e.rating),s.a.createElement(P.a,{rating:e.rating,starEmptyColor:"#e1e1e1",starHoverColor:"gold",starRatedColor:"#ffcc00",name:"rating",starDimension:"16px",starSpacing:"2px"}),s.a.createElement("span",{style:{color:"#9a9a9a",marginRight:"5px",marginLeft:"7px"}},"(",e.user_ratings_total||0,")")),s.a.createElement(v.b,{description:e.address,style:{marginTop:"-20px"}}))}))))))),s.a.createElement(v.o,{id:"friends",activePanel:"friends"},s.a.createElement(v.i,{id:"friends"},s.a.createElement(v.j,null,"\u041d\u0430 \u041c\u0435\u0441\u0442\u0435"),s.a.createElement(v.k,{onRefresh:this.onRefreshFriends,isFetching:this.state.isFetchingFriends},s.a.createElement(v.g,null,s.a.createElement(v.h,null,this.state.userFriendsInApp.map((function(e,t){return s.a.createElement(v.d,{key:t},s.a.createElement(v.b,{before:s.a.createElement(v.a,{src:e.photo_200})},s.a.createElement("span",{style:{color:"#3a3a3a"}},e.first_name+" "+e.last_name),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#9a9a9a"}},"1 \u0443\u0440\u043e\u0432\u0435\u043d\u044c")))}))))))),s.a.createElement(v.o,{id:"profile",activePanel:"profile"},s.a.createElement(v.i,{id:"profile"},s.a.createElement(v.j,null,"\u041d\u0430 \u041c\u0435\u0441\u0442\u0435"),s.a.createElement(v.k,{onRefresh:this.onRefreshProfile,isFetching:this.state.isFetchingProfile},this.state.fetchedUser&&s.a.createElement(v.g,null,s.a.createElement(v.h,null,s.a.createElement(v.d,null,s.a.createElement(v.b,{before:this.state.fetchedUser.photo_200?s.a.createElement(v.a,{src:this.state.fetchedUser.photo_200}):s.a.createElement(v.a,null,s.a.createElement(A.a,null))},s.a.createElement("span",{style:{color:"#3a3a3a"}},"".concat(this.state.fetchedUser.first_name," ").concat(this.state.fetchedUser.last_name)),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#9a9a9a"}},"1 \u0443\u0440\u043e\u0432\u0435\u043d\u044c"))))))))))}}]),t}(s.a.Component));c.a.send("VKWebAppInit"),r.a.render(s.a.createElement(_,null),document.getElementById("root"))}},[[162,1,2]]]);
//# sourceMappingURL=main.e07e7ebc.chunk.js.map